<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Licytacja miejsc w I30</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üöó</text></svg>">
  <style>
    select option {
      white-space: normal;
      word-wrap: break-word;
    }
    /* standardowy rozmiar selecta */
    #pickupSelect {
      font-size: 15px; /* normalny rozmiar na desktopie */
    }

    /* dla ekran√≥w wƒô≈ºszych ni≈º 600px (telefony) */
    @media (max-width: 500px) {
      #pickupSelect {
        font-size: 11px; /* mniejszy rozmiar na telefonie */
      }
    }
    :root{font-family:Inter,system-ui,Arial,Helvetica,sans-serif;color:#111}
    body{max-width:920px;margin:28px auto;padding:18px}
    h1,h2{margin:8px 0}
    .card{border:1px solid #e6e6e6;border-radius:10px;padding:14px;margin:12px 0;box-shadow:0 2px 6px rgba(0,0,0,0.03)}
    label{display:block;margin:8px 0 4px;font-weight:600}
    input,select,button{padding:8px 10px;border-radius:8px;border:1px solid #ccc;font-size:15px}
    .row{display:flex;gap:10px;align-items:center}
    .spacer{flex:1}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
    .muted{color:#666;font-size:13px}
    .big{font-size:20px;font-weight:700}
    .countdown{font-weight:700;color:#b22222}
    .copyok{color:green;margin-left:8px}
    .admin-toggle{background:#f3f3f3;border:0}
    .admin-panel{margin-top:10px}
    .btn{background:#0070f3;color:white;border:0;padding:10px 12px;border-radius:8px;cursor:pointer}
    .btn-ghost{background:transparent;border:1px solid #0070f3;color:#0070f3}
    .center{text-align:center}
    footer{margin-top:18px;font-size:13px;color:#444}
    .note{font-size:13px;color:#333}

    /* toast */
    .toast{position:fixed;right:20px;bottom:20px;background:#111;color:white;padding:10px 14px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.2);opacity:0;transform:translateY(10px);transition:opacity .25s,transform .25s;z-index:9999}
    .toast.show{opacity:1;transform:translateY(0)}
    /* obrazek na ko≈Ñcu strony */
    .end-image-card{
      margin:18px auto;
      padding:14px;
      border-radius:12px;
      box-shadow:0 8px 24px rgba(0,0,0,0.12);
      max-width:920px;
      background:linear-gradient(180deg, rgba(255,255,255,0.95), rgba(250,250,250,0.95));
      text-align:center;
    }
    .end-image-card img.hero-image{
      display:block;
      margin:8px auto;
      max-width:100%;
      height:auto;
      border-radius:10px;
      box-shadow:0 6px 18px rgba(0,0,0,0.08);
    }
    .end-image-card .img-caption{
      margin-top:8px;
      color:#444;
      font-size:13px;
    }
    /* karta z mapƒÖ trasy */
    .map-card{
      margin:14px 0;
      padding:0;
      border-radius:12px;
      overflow:hidden;
      box-shadow:0 10px 30px rgba(0,0,0,0.10);
      background:#fff;
      position:relative;
      border:1px solid rgba(0,0,0,0.06);
    }

    /* obraz wewnƒÖtrz karty */
    .map-card img{
      display:block;
      width:100%;
      height:auto;
      object-fit:cover;
      -webkit-user-drag: none;
      transition: transform .35s ease;
    }

    /* ma≈Çy badge z czasem/dystansem (opcjonalny) */
    .map-card .badge{
      position:absolute;
      left:12px;
      top:12px;
      background:rgba(255,255,255,0.95);
      padding:8px 10px;
      border-radius:8px;
      font-weight:700;
      box-shadow:0 6px 18px rgba(0,0,0,0.08);
      z-index:5;
      font-size:13px;
    }

    /* podpis pod obrazem */
    .map-card .img-caption{
      padding:10px 14px;
      color:#444;
      font-size:13px;
      text-align:left;
      background:linear-gradient(180deg, rgba(255,255,255,0.95), rgba(250,250,250,0.95));
    }

    /* efekt hover (delikatne powiƒôkszenie) */
    .map-card:hover img{ transform:scale(1.02); }


  </style>
</head>
<body>
  <h1>Licytacja miejsc na trasƒô Czƒôstochowa ‚Üí Radostk√≥w</h1>
  <!-- karta z mapƒÖ trasy (wstaw po "Status licytacji") -->
  <div class="map-card" aria-hidden="false">
    <div class="badge">30 minut ¬∑ 20 km</div>
    <img src="trasa30.png" alt="Mapa trasy I30 ‚Äî Czƒôstochowa ‚Üí Radostk√≥w" />
    <div class="img-caption">Mapa trasy I30 ‚Äî orientacyjny czas i odleg≈Ço≈õƒá. Wyjazd (w zale≈ºno≈õci od miejsca odbioru) 29 sierpnia od godziny 16:00; dojazd na miejsce o godzinie 17:00</div>
  </div>


  <div class="card">
    <h2>Status licytacji</h2>
    <div class="row">
      <div>Do zako≈Ñczenia:</div>
      <div class="countdown" id="countdown">≈Çadowanie...</div>
      <div class="spacer"></div>
      <div class="muted">Koniec: <span id="endDateText"></span></div>
    </div>
    <table>
      <thead><tr><th>Miejsce</th><th>Aktualna kwota</th><th>Obecny lider</th></tr></thead>
      <tbody id="seatsTable"></tbody>
    </table>
  </div>

  <div class="card">
    <h2>Wejd≈∫ i wygeneruj kod licytacji</h2>
    <label>Wpisz swoje imiƒô i nazwisko (takie jak na grupie)</label>
    <div class="row">
      <input id="fullname" placeholder="np. Adam Starak" />
      <button class="btn" id="saveNameBtn">Zapisz</button>
      <div id="nameSaved" class="muted"></div>
    </div>

    <label>Wybierz miejsce z listy</label>
    <select id="seatSelect"></select>

    <!-- pole do wpisania oferty -->
    <label>Twoja oferta w Polskiej Walucie (musi byƒá wiƒôksza od poprzedniej oferty o conajmniej 10 groszy): </span></label>
    <input type="number" id="userBid" min="0.1" />

    <label>Miejsce odbioru</label>
    <select id="pickupSelect"></select>
    <div id="customKmRow" style="display:none; margin-top:8px">
      <label>Ile kilometr√≥w od dowolnego miejsca z listy</label>
      <input type="number" id="customKm" min="1" value="0" />
    </div>

    <div style="margin-top:10px" class="row">
      <button class="btn" id="generateBtn">Licytuj (generuj kod)</button>
      <div class="spacer"></div>
      <div class="muted">Dop≈Çata przy wybraniu opcji w≈Çasnego miejsca (za kilometr): <span id="extraPerKmView"></span> z≈Ç</div>
    </div>

    <div id="result" class="card" style="display:none;margin-top:12px">
      <div class="big">≈ÅƒÖczna kwota: <span id="totalAmount"></span> z≈Ç</div>
      <div style="margin-top:6px">Kod do wys≈Çania: <strong id="shortCode"></strong>
        <button class="btn-ghost" id="copyBtn">Kopiuj</button><span id="copyOK" class="copyok" style="display:none">Skopiowano!</span>
      </div>
      <p style="margin-top:8px">Wy≈õlij powy≈ºszy kod SMS-em na numer: <strong id="phoneView"></strong><br>Wys≈Çanie kodu jest r√≥wnoznaczne z zaakceptowaniem w przypadku wygranej zadeklarowanej kwoty.</p>
    </div>
  </div>

  <!-- PANEL ADMINA -->
  <div class="card" id="adminCard" style="display:none">
    <div class="row">
      <h3 style="margin:0">Panel admina (szybka edycja zmiennych)</h3>
      <div class="spacer"></div>
      <button class="admin-toggle" id="toggleAdmin">Poka≈º/Ukryj</button>
    </div>
    <div id="adminPanel" class="admin-panel" style="display:none">
      <div class="muted">Edytuj kwoty i nazwy prowadzƒÖcych (lokalnie).</div>
      <div id="adminSeats"></div>
      <div style="margin-top:8px" class="row">
        <button class="btn" id="saveAdmin">Zapisz zmiany</button>
        <button class="btn-ghost" id="resetConfig">Resetuj</button>
      </div>
    </div>
  </div>

  <footer>
    <div class="muted" style="text-align: center;">licytacja trwa do 29 sierpnia 2025, 15:00 ‚Ä¢ w przypadku wygranej zostanie wys≈Çane potwierdzenie na numer, z kt√≥rego by≈Ç wys≈Çany kod licytacji ‚Ä¢ zapewniamy przejazd w tym klimatyzacjƒô, wyb√≥r muzyki i dobrƒÖ atmosferƒô ‚Ä¢ tylko dla zaproszonych os√≥b bƒôdƒÖcych na grupie w aplikacji Messenger</div>
  </footer>

    <!-- obrazek podr√≥≈ºy -->
  <div class="end-image-card">
    <!-- je≈õli Twoja przeglƒÖdarka/serwer nie obs≈Çuguje znak√≥w w nazwie pliku dobrze, u≈ºyj zakodowanej nazwy:
        src="i30%20podr%C3%B3%C5%BC.png"  -->
    <img src="i30 podr√≥≈º.png" alt="i30 podr√≥≈º ‚Äî ilustracja" class="hero-image" />
    <div class="img-caption">auto do przejazdu czyli hundai i30 ‚Äî mi≈Çego podr√≥≈ºowania ≈ºyczy firma Tester Oryginal üòê</div>
  </div>

  <footer>
    <div class="muted" style="text-align: center;">stronƒô wykona≈Ç Szymon Kopanicki (kontakt: kopanicki2007@gmail.com)</div>
  </footer>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // Local config + server sync
    const STORAGE_KEY = 'licytacja_config_v1';
    const SERVER_POLL_MS = 3000; // poll server every 3s
    const MIN_BID_STEP = 0.1; // minimalny krok oferty

    const DEFAULT_CONFIG = {
      seats: [
        { id: 'seat1', label: 'Fotel obok najlepszego kierowcy üòé', currentBid: 0.5, leader: 'Kacperek Rosek' },
        { id: 'seat2', label: 'Miejsce z ty≈Çu za pasa≈ºerem',         currentBid: 0.1, leader: 'Ksenia Gasiak ‚ù§Ô∏è' },
        { id: 'seat3', label: 'Miejsce na ≈õrodku z ty≈Çu',            currentBid: 0, leader: '(puste)' },
        { id: 'seat4', label: 'Miejsce za super kierowcƒÖ',           currentBid: 0, leader: '(puste)' }
      ],
      auctionEndISO: '2025-08-29T15:00:00+02:00',
      phoneNumber: '+48 797318071',
      extraPerKm: 0.80,
      pickupOptions: [
        { id: 'wrzosowiak', label: 'Czƒôstochowa - Wrzosowiak - przystanek Rutkiewicz', shortLabel: 'Czƒôstochowa - Wrzosowiak', extraKm: 0 },
        { id: 'ostatnigrosz', label: 'Czƒôstochowa - Ostatni Grosz - Netto na ul. B√≥r', shortLabel: 'Czƒôstochowa - Ostatni Grosz', extraKm: 0 },
        { id: 'centrum', label: 'Czƒôstochowa - Centrum - parking przy dworcu PKS', shortLabel: 'Czƒôstochowa - Centrum', extraKm: 0 },
        { id: 'p√≥≈Çnoc', label: 'Czƒôstochowa - P√≥≈Çnoc - KFC przy M1', shortLabel: 'Czƒôstochowa - P√≥≈Çnoc', extraKm: 0 },
        { id: 'wierzchowisko', label: 'Wierzchowisko - koniec ul. D≈Çugiej po stronie zachodniej', shortLabel: 'Wierzchowisko', extraKm: 0 },
        { id: 'radostk√≥w', label: 'Radostk√≥w - szko≈Ça podstawowa', shortLabel: 'Radostk√≥w', extraKm: 0 },
        { id: 'custom', label: 'W≈Çasne miejsce', shortLabel: 'W≈Çasne miejsce', extraKm: null }
      ]
    };

    // load/save config from localStorage so bids persist
    function loadConfig(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return JSON.parse(JSON.stringify(DEFAULT_CONFIG));
        const parsed = JSON.parse(raw);
        if(!parsed.seats) parsed.seats = JSON.parse(JSON.stringify(DEFAULT_CONFIG.seats));
        return parsed;
      }catch(e){ return JSON.parse(JSON.stringify(DEFAULT_CONFIG)); }
    }
    function saveConfig(cfg){ localStorage.setItem(STORAGE_KEY, JSON.stringify(cfg)); }

    let CONFIG = loadConfig();

    const seatsTable = document.getElementById('seatsTable');
    const seatSelect = document.getElementById('seatSelect');
    const pickupSelect = document.getElementById('pickupSelect');
    const customKmRow = document.getElementById('customKmRow');
    const customKmInput = document.getElementById('customKm');
    const extraPerKmView = document.getElementById('extraPerKmView');
    const phoneView = document.getElementById('phoneView');
    const countdownEl = document.getElementById('countdown');
    const endDateText = document.getElementById('endDateText');
    const generateBtn = document.getElementById('generateBtn');
    const adminCard = document.getElementById('adminCard');
    const toastEl = document.getElementById('toast');
    const minStepView = document.getElementById('minStepView');
    if (minStepView) {
      minStepView.textContent = MIN_BID_STEP;
    }

    function renderSeatsTable(seats){
      seatsTable.innerHTML = '';
      seats.forEach(s=>{
        const tr = document.createElement('tr');
        tr.innerHTML = '<td>' + escapeHtml(s.label) + '</td><td>' + s.currentBid + ' z≈Ç</td><td>' + escapeHtml(s.leader) + '</td>';
        seatsTable.appendChild(tr);
      });
    }

function populateSelects(seats){
  // wype≈Çnij select miejsc (seatSelect)
  seatSelect.innerHTML = '';
  seats.forEach(s => {
    const opt = document.createElement('option');
    opt.value = s.id;
    opt.textContent = s.label;
    seatSelect.appendChild(opt);
  });
  // ustaw domy≈õlnie pierwszy element (je≈õli istnieje)
  if(seats.length > 0) seatSelect.selectedIndex = 0;

  // wype≈Çnij select miejsc odbioru (pickupSelect) ‚Äî poka≈º pe≈ÇnƒÖ nazwƒô (label)
  pickupSelect.innerHTML = '';
  const pickups = CONFIG.pickupOptions || DEFAULT_CONFIG.pickupOptions;
  pickups.forEach(p => {
    const opt = document.createElement('option');
    opt.value = p.id;        // id u≈ºywane w logice (np. 'custom')
    opt.textContent = p.label; // <-- pe≈Çna nazwa widoczna od razu w li≈õcie
    // opcjonalnie zostaw shortLabel w atrybucie data, je≈õli bƒôdzie potrzebne gdzie indziej:
    opt.dataset.short = p.shortLabel;
    pickupSelect.appendChild(opt);
  });
  if(pickups.length > 0) pickupSelect.selectedIndex = 0;

  extraPerKmView.textContent = CONFIG.extraPerKm;
  phoneView.textContent = CONFIG.phoneNumber;
  endDateText.textContent = new Date(CONFIG.auctionEndISO).toLocaleString('pl-PL', {timeZone:'Europe/Warsaw'});

  updateUserBidConstraints();
}

    const auctionEndDate = new Date(CONFIG.auctionEndISO);
    function updateCountdown(){
      const now = new Date();
      const diff = auctionEndDate - now;
      if(diff<=0){
        countdownEl.textContent = 'Licytacja zako≈Ñczona';
        generateBtn.disabled = true;
        return;
      }
      const d = Math.floor(diff/1000/60/60/24);
      const h = Math.floor(diff/1000/60/60)%24;
      const m = Math.floor(diff/1000/60)%60;
      const s = Math.floor(diff/1000)%60;
      countdownEl.textContent = d + ' dni ' + h + ' godzin ' + m + ' minut ' + s + ' sekund';
    }
    setInterval(updateCountdown,1000);


    // hashowanie kodu i jego generowanie
    function generateShortCode(fullName, amount, seatId){
      const parts = fullName.trim().split(/\s+/);
      if(parts.length===0) return '';
      const first = parts[0].toUpperCase();
      const lastInitial = parts.length>1 ? parts[parts.length-1].charAt(0).toUpperCase() : '';
      const seatNum = seatId.replace('seat','');
      let unprot = seatNum + first + lastInitial + amount;
      let hasz = 12345;
      for (let i = 0; i < unprot.length; i++) {
        hasz = (hasz * (unprot.charCodeAt(i)+1) + i) % 100000;
      }
      let haszt = hasz;
      let hasz2 = 0;
      while (haszt>0){
        hasz2 = hasz2 + haszt%10;
        haszt = Math.floor(haszt / 10);
      }
      return 'CR' + seatNum + first + hasz%100000 + hasz2%10 + lastInitial + amount;
    }

    function updateUserBidConstraints(){
      const seatId = seatSelect.value;
      const seat = CONFIG.seats.find(s=>s.id===seatId);
      const bidInput = document.getElementById('userBid');
      if(seat){
        const min = Math.max(0, seat.currentBid + MIN_BID_STEP);
        bidInput.min = String(min);
        if(!bidInput.value || Number(bidInput.value) < min) bidInput.value = String(min);
      } else {
        bidInput.min = '0.1';
        if(!bidInput.value) bidInput.value = '0.1';
      }
    }

    // --- server sync helpers ---
    async function fetchSeatsFromServer(){
      try{
        const res = await fetch('/seats');
        if(!res.ok) throw new Error('no server');
        const ct = (res.headers.get('content-type')||'').toLowerCase();
        if(!ct.includes('application/json')) throw new Error('not json');
        const remote = await res.json();
        if(Array.isArray(remote)){
          CONFIG.seats = remote;
          saveConfig(CONFIG);
          renderSeatsTable(CONFIG.seats);
          populateSelects(CONFIG.seats);
          return true;
        }
        return false;
      }catch(e){
        // server not available -> ignore
        return false;
      }
    }

    async function pushSeatsToServer(){
      try{
        const res = await fetch('/seats', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(CONFIG.seats) });
        return res.ok;
      }catch(e){ return false; }
    }

    // simple toast
    let toastTimer = null;
    function showToast(msg, ms=2500){
      clearTimeout(toastTimer);
      toastEl.textContent = msg; toastEl.classList.add('show');
      toastTimer = setTimeout(()=>{ toastEl.classList.remove('show'); }, ms);
    }

    generateBtn.addEventListener('click', async ()=>{
      if(new Date() > auctionEndDate){ alert("Licytacja zako≈Ñczona."); return; }
      const fullname = (document.getElementById('fullname').value || '').trim();
      if(!fullname){ alert('Wpisz imiƒô i nazwisko.'); return; }
      const seatId = seatSelect.value;
      const seat = CONFIG.seats.find(s=>s.id===seatId);
      if(!seat){ alert('Nie znaleziono miejsca.'); return; }
      const userBidEl = document.getElementById('userBid');
      const userBid = Number(userBidEl.value);
      const minRequired = seat.currentBid + MIN_BID_STEP;
      if(!userBid || userBid < minRequired){
        alert('Twoja oferta musi byƒá co najmniej ' + minRequired + ' z≈Ç (aktualna ' + seat.currentBid + ' z≈Ç + krok ' + MIN_BID_STEP + ' z≈Ç)');
        return;
      }
      const pickup = pickupSelect.value;
      let extraKm = 0;
      if(pickup==='custom'){ extraKm = parseInt(customKmInput.value)||0; }
      const total = userBid + (extraKm * CONFIG.extraPerKm);

      // update seat locally
      // seat.currentBid = userBid;
      // seat.leader = fullname;
      // saveConfig(CONFIG);
      // renderSeatsTable(CONFIG.seats);
      // populateSelects(CONFIG.seats);

      // push to server (best-effort)
      const pushed = await pushSeatsToServer();
      if(pushed){
        showToast('Oferta przyjƒôta i zsynchronizowana z serwerem.');
      } else {
        showToast('Tw√≥j unikalny kod oferty zosta≈Ç wygenerowany!');
      }

      document.getElementById('totalAmount').textContent = total;
      const code = generateShortCode(fullname, userBid, seatId);
      document.getElementById('shortCode').textContent = code;
      document.getElementById('result').style.display = 'block';
    });

    // admin widoczny tylko dla "tylko przejazd"
    document.getElementById('saveNameBtn').addEventListener('click', ()=>{
      const v = (document.getElementById('fullname').value || '').trim();
      if(!v){ alert('Wpisz swoje imiƒô i nazwisko.'); return; }
      localStorage.setItem('licytacja_fullname', v);
      document.getElementById('nameSaved').textContent = 'zapisano!';
      setTimeout(()=>document.getElementById('nameSaved').textContent='',3000);
      if(v.toLowerCase()==="tylko przejazd"){ adminCard.style.display='block'; }
    });

    pickupSelect.addEventListener('change', ()=>{
      if(pickupSelect.value==='custom') customKmRow.style.display='block'; else customKmRow.style.display='none';
    });

    // admin controls (same as before)
    document.getElementById('toggleAdmin').addEventListener('click', ()=>{
      const ap = document.getElementById('adminPanel'); ap.style.display = ap.style.display==='none' ? 'block' : 'none'; renderAdmin();
    });

    function renderAdmin(){
      const root = document.getElementById('adminSeats'); root.innerHTML='';
      CONFIG.seats.forEach((s,idx)=>{
        const div = document.createElement('div'); div.style.marginTop='6px';
        div.innerHTML = '<div class=\"row\"><input data-idx=\"' + idx + '\" class=\"admin-label\" value=\"' + escapeHtml(s.label) + '\" /><input data-idx=\"' + idx + '\" class=\"admin-bid\" type=\"number\" value=\"' + s.currentBid + '\" style=\"width:120px\" /><input data-idx=\"' + idx + '\" class=\"admin-leader\" value=\"' + escapeHtml(s.leader) + '\" /><button class=\"btn-ghost\" data-idx=\"' + idx + '\">Usu≈Ñ</button></div>';
        root.appendChild(div);
      });
      root.querySelectorAll('.btn-ghost').forEach(b=>b.addEventListener('click', (ev)=>{
        const idx = Number(ev.currentTarget.dataset.idx); CONFIG.seats.splice(idx,1); saveConfig(CONFIG); renderAdmin(); renderSeatsTable(CONFIG.seats); populateSelects(CONFIG.seats);
      }));
    }

    document.getElementById('saveAdmin').addEventListener('click', ()=>{
      const labels = Array.from(document.querySelectorAll('.admin-label')).map(i=>i.value.trim());
      const bids = Array.from(document.querySelectorAll('.admin-bid')).map(i=>Number(i.value)||0);
      const leaders = Array.from(document.querySelectorAll('.admin-leader')).map(i=>i.value.trim());
      CONFIG.seats.forEach((s,idx)=>{ s.label = labels[idx] || s.label; s.currentBid = bids[idx]||s.currentBid; s.leader = leaders[idx]||s.leader; });
      saveConfig(CONFIG); renderSeatsTable(CONFIG.seats); populateSelects(CONFIG.seats); renderAdmin();
      pushSeatsToServer();
    });

    document.getElementById('resetConfig').addEventListener('click', ()=>{
      if(!confirm('Czy na pewno zresetowaƒá konfiguracjƒô?')) return;
      CONFIG = JSON.parse(JSON.stringify(DEFAULT_CONFIG)); saveConfig(CONFIG); renderSeatsTable(CONFIG.seats); populateSelects(CONFIG.seats); renderAdmin();
      pushSeatsToServer();
    });

    // copy button
    document.getElementById('copyBtn').addEventListener('click', ()=>{
      const text = document.getElementById('shortCode').textContent.trim();
      navigator.clipboard.writeText(text).then(()=>{ document.getElementById('copyOK').style.display='inline'; setTimeout(()=>document.getElementById('copyOK').style.display='none',1500); });
    });

    // helpers
    function escapeHtml(str){ return String(str||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\"/g,'&quot;').replace(/'/g,'&#39;'); }

    // init: load config, try fetch from server, start polling
    (async function init(){
      renderSeatsTable(CONFIG.seats);
      populateSelects(CONFIG.seats);
      updateCountdown();
      const savedName = localStorage.getItem('licytacja_fullname');
      if(savedName){ document.getElementById('fullname').value = savedName; if(savedName.toLowerCase()==="tylko przejazd"){ adminCard.style.display='block'; }}

      // initial fetch from server if available
      await fetchSeatsFromServer();

      // start polling server so other computers see updates
      setInterval(fetchSeatsFromServer, SERVER_POLL_MS);
    })();

    // persist config locally
    function saveConfig(cfg){ localStorage.setItem(STORAGE_KEY, JSON.stringify(cfg)); }

  </script>
</body>
</html>

